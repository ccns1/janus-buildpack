#!/bin/bash

indent() {
  sed -u 's/^/       /'
}

echo "-----> Starting Janus install.."
# Create a log file of the build as well as displaying the build on the tty as it runs
exec > >(tee aws_janus_build.log)
exec 2>&1
#set -e

APP="$1/.apt/usr"

cd $APP

curl https://dl.dropboxusercontent.com/u/7664611/app.tar.gz | tar xzv

export PATH="$PATH:$APP/bin"
export INCLUDE_PATH="$INCLUDE_PATH:$APP/include"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$APP/lib"
export PKG_CONFIG_PATH="$PKG_CONFIG_PATH:$APP/lib/pkgconfig"
echo "export PATH=\"$PATH:$APP/bin\"" >> $HOME/.bashrc
echo "export INCLUDE_PATH=\"$INCLUDE_PATH:$APP/include\"" >> $HOME/.bashrc
echo "export LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:$APP/lib\"" >> $HOME/.bashrc
echo "export PKG_CONFIG_PATH=\"$PKG_CONFIG_PATH:$APP/lib/pkgconfig\"" >> $HOME/.bashrc

echo $PATH

cd $APP/janus-gateway
./janus --version

echo "-----> Janus install complete"