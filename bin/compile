#!/bin/bash

indent() {
  sed -u 's/^/       /'
}

echo "-----> Starting Janus install.."

#ln -s /usr/include/libv4l1-videodev.h /usr/include/linux/videodev.h

cd $1

while read url; do
  cd $1
  echo "-----> Fetching $url..."
  [ ! -d $(grep -oP "[^/]*(?=\.tar)" <<< $url) ] && curl -s $url | tar xz
  cd $(grep -oP "[^/]*(?=\.tar)" <<< $url)
  echo "-----> Configure $(grep -oP "[^/]*(?=\.tar)" <<< $url)..."
  ./configure --prefix=/app/bin
  echo "-----> Make $(grep -oP "[^/]*(?=\.tar)" <<< $url)..."
  make && make install
  echo "-----> Make $(grep -oP "[^/]*(?=\.tar)" <<< $url) Complete."
done < .janustars

cd $1
yasm --version
find / -name yasm
echo $PATH
ls -ld /app/bin
ls -ld /app/vendor/bundle/bin
ls -ld /app/vendor/bundle/ruby/2.2.0/bin
ls -ld /usr/local/bin
ls -ld /usr/bin
ls -ld /bin
ls -ld /tmp/codon/vendor/bin

echo $LD_LIBRARY_PATH

echo "-----> Janus install complete"